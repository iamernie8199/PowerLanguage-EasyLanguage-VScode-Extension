{
  "scopeName": "source.powerlanguage",
  "patterns": [{ "include": "#expression" }],
  "repository": {
    "expression": {
      "patterns": [
        { "include": "#var" },
        { "include": "#paren-expression" },
        { "include": "#function" },
        { "name": "string.quoted.single", "begin": "'", "end": "'" },
        { "name": "string.quoted.double", "begin": "\"", "end": "\"" },
        { "name": "keyword.operator.logical", "match": "(?i)\\b(or|and|not)" },
        { "name": "support.type.order", "match":"\\b(?i)(buy|sell|buytocover|sellshort)\\b"},
        { "name": "constant.numeric.decimal", "match": "[0-9]+" },
        {
          "name": "keyword.control",
          "match": "(?i)(((if|else|while|for|then|to|begin|)\\s)|\\bend(?=;|\\s))"
        },
        {
          "name": "invalid.deprecated",
          "match": "(?i)((?<=\\W)(A|An|At|Based|By|Does|Is|Of|On|Place|Than|The|Was)\\b)"
        },
        {
          "name": "keyword.operator.comparison",
          "match": "<|<=|<>|=|>=|>|(?i)(cross(es)? (over|below))"
        },
        {
          "name": "comment.block",
          "begin": "{",
          "beginCaptures": {
            "0": { "name": "punctuation.definition.comment.begin" }
          },
          "end": "}",
          "endCaptures": {
            "0": { "name": "punctuation.definition.comment.end" }
          }
        },
        {
          "name": "comment.line.double-slash",
          "begin": "//",
          "beginCaptures": {
            "0": { "name": "punctuation.definition.comment" }
          },
          "end": "\n"
        },
        {
          "name": "constant.language",
          "match": "(?i)(marketposition|barssinceentry|market(?=;)|var(?:s|iable(?:s|)|)|array|false|true|data[0-9]|input(?:s|)|ticks|(?<=\\W)(o(pen)?|h(igh)?|l(ow)?|c(lose)?|t(ime)?|v(olume)?|d(ay)?)(?=\\W))"
        }
      ]
    },
    "function": {
      "patterns": [
        {
          "match": "(?i)((?<=\\s|=|\\()iff|summation|XAverage|WAverage|EntriesToday|SquareRoot|typicalprice|ceiling|floor|(open|high|low|close)d)",
          "name": "support.function"
        }
      ]
    },
    "var": {
      "match": "(?i)value[0-9]|(?i)plot[0-9]|(?i)condition[0-9]",
      "name": "keyword.var"
    },
    "paren-expression": {
      "begin": "\\(",
      "end": "\\)",
      "beginCaptures": {
        "0": { "name": "punctuation.paren.open" }
      },
      "endCaptures": {
        "0": { "name": "punctuation.paren.close" }
      },
      "name": "expression.group",
      "patterns": [{ "include": "#expression" }]
    }
  }
}
