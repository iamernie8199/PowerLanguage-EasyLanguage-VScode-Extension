{
    "scopeName": "source.powerlanguage",
    "patterns": [{ "include": "#expression" }],
    "repository": {
      "expression": {
        "patterns": [
            { "include": "#comments_line" },
            { "include": "#comments_block" },
            { "include": "#letter" }, 
            { "include": "#var" },
            { "include": "#paren-expression" },
            { "include": "#entities" },  
            { "include": "#function" },
            { "include": "#operators" },
            { "include": "#control" }]
      },
      "comments_line": {
        "begin": "//",
        "beginCaptures": {
            "0": {
                "name": "punctuation.definition.comment"
            }
        },
        "end": "(?=\")|\\n",
        "name": "comment.line.double-slash"
      },
      "comments_block":{
        "begin": "{",
        "beginCaptures": {
            "0": {
                "name": "punctuation.definition.comment.begin"
            }
        },
        "end": "(?=\")|}",
        "endCaptures": {
            "0": {
                "name": "punctuation.definition.comment.end"
            }
        },
        "name": "comment.block"
        },
      "control": {
        "match": "(?i)(if|else|while|for|then|to|begin|)\\s|end",
        "name": "keyword.control.untitled"
      },
      "function": {
        "patterns": [{
          "match": "(?i)((?<=\\s|=|\\()iff|summation|XAverage|typicalprice)",
          "name": "constant.character.entity.name.function"
        }]
      },
      "letter": {
        "match": "(?i)(marketposition|var(?:s|iable(?:s|)|)|array|data[0-9]|input|ticks|(?<=\\s|=|\\()(o(pen)?|h(igh)?|l(ow)?|c(lose)?|t(ime)?|v(olume)?|d(ay)?)(?=\\s|=|\\)))",
        "name": "constant.character"
      },
      "var": {
        "match": "(?i)value[0-9]|(?i)plot[0-9]|(?i)condition[0-9]",
        "name": "keyword.var"
      },
      "operators": {
        "match": "(?i)(or|and|true|false)",
        "name": "keyword.op"
      },
      "paren-expression": {
        "begin": "\\(",
        "end": "\\)",
        "beginCaptures": {
          "0": { "name": "punctuation.paren.open" }
        },
        "endCaptures": {
          "0": { "name": "punctuation.paren.close" }
        },
        "name": "expression.group",
        "patterns": [{ "include": "#expression" }]
      },
      "entities": {
        "patterns": [{
          "match": "[0-9]+",
          "name": "constant.character.entity.numeric.decimal"
        }]
      }
    }
  }